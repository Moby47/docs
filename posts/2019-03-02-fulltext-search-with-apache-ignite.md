---
ID: 776
post_title: Fulltext search with Apache Ignite
author: zcourts
post_excerpt: >
  Using Apache Ignite? Ever wanted to find
  data by more than just an ID? In this
  post we discuss how Hypi implements
  Fulltext search on top of Apache Ignite
  as presented at both the Paris and
  London Feb 2019 In Memory Computing
  meetups.
layout: post
permalink: >
  https://hypi.io/blog/platform/technical-blog/fulltext-search-with-apache-ignite/
published: true
post_date: 2019-03-02 01:33:48
---
<!-- wp:paragraph -->

[Apache Ignite][1] is a memory centric platform for storage, analytics and computation. [Hypi][2] builds on top of Ignite to provide a low-code serverless platform that enables rapid application development.

<!-- /wp:paragraph -->

<!-- wp:paragraph -->

To do this, Hypi makes heavy use of Ignite's key value APIs. Ignite itself is very flexible and provides several APIs as a means of interacting with it and the data within it. These include [Ignite's SQL99][3] API which gives you access to data via standard SQL and several others.

<!-- /wp:paragraph -->

<!-- wp:paragraph -->

Ignite features [machine learning APIs][4] and as of Ignite 2.7, [Tensorflow integration][5]. All things Hypi will be making available over time.

<!-- /wp:paragraph -->

<!-- wp:paragraph -->

In this post, we will focus on one specific feature in Hypi., fulltext search. We've put out an introduction to Hypi's query language before in the [HypiQL post (now renamed to ArcQL)][6]. It covers the syntax/grammar but not much else.

<!-- /wp:paragraph -->

<!-- wp:paragraph -->

Here, we'll discuss briefly how that syntax maps down to actually finding your data in the Hypi platform.

<!-- /wp:paragraph -->

<!-- wp:paragraph -->

You can skip some of this and jump into the slides we presented at the [Paris][7] and [London][8] in memory computing meetups in Feb 2019. 

<!-- /wp:paragraph -->

<!-- wp:file {"id":780,"href":"https://hypi.io/wp-content/uploads/2019/03/Hypi-GraphQL-Fulltext-london.pdf"} -->

<div class="wp-block-file">
  <a href="https://hypi.io/wp-content/uploads/2019/03/Hypi-GraphQL-Fulltext-london.pdf">Hypi GraphQL Fulltext </a><a href="https://hypi.io/wp-content/uploads/2019/03/Hypi-GraphQL-Fulltext-london.pdf" class="wp-block-file__button" download></a>
</div>

<!-- /wp:file -->

<!-- wp:paragraph -->

Read on for a break down.

<!-- /wp:paragraph -->

<!-- wp:paragraph -->

First, it helps to become aquatinted with how Hypi knows what data you want to put into the platform. It its core is [GraphQL][9]. The slides use a model that looks like this:

<!-- /wp:paragraph -->

<!-- wp:paragraph -->

<img class="wp-image-783" style="width: 512px;" src="https://hypi.io/wp-content/uploads/2019/03/Screen-Shot-2019-02-26-at-17.03.55.png" alt="Hypi GraphQL TODO model" />

<!-- /wp:paragraph -->

<!-- wp:paragraph -->

You'll have noticed the use of `@field` in the type declarations. This is a Hypi directive that allows the developer of an app to customise some aspect of how Hypi deals with the field to which it is applied. In this image, two things are being done.

<!-- /wp:paragraph -->

<!-- wp:list {"ordered":true} -->

1.  indexed: true - This will cause Hypi to index the field, making its contents searchable via ArcQL
2.  type: Keyword - Where this is applied, the field will be used for exact matches. This is good for things like IDs, or emails that must match exactly. If this is not set, it defaults to `Text` which causes partial matches to work (like search engines)

<!-- /wp:list -->

<!-- wp:paragraph -->

The slides demonstrate the this model would produce a GraphQL API that looks like this:

<!-- /wp:paragraph -->

<!-- wp:image {"id":785} --><figure class="wp-block-image">

<img src="https://hypi.io/wp-content/uploads/2019/03/Screen-Shot-2019-03-02-at-00.57.22-1024x502.png" alt="" class="wp-image-785" /><figcaption>Default GraphQL CRUD API generated by Hypi  
</figcaption></figure> <!-- /wp:image -->

<!-- wp:paragraph -->

Hypi allows an ArcQL parameter to later filter any data inserted with these models. ArcQL, being implemented on top of [Apache Lucene][10] supports many different types of queries. At present there are seven types:

<!-- /wp:paragraph -->

<!-- wp:image {"id":786} --><figure class="wp-block-image">

<img src="https://hypi.io/wp-content/uploads/2019/03/Screen-Shot-2019-03-02-at-00.59.24-1024x647.png" alt="" class="wp-image-786" /><figcaption>Types of queries supported by ArcQL</figcaption></figure> <!-- /wp:image -->

<!-- wp:list {"ordered":true} -->

1.  Term queries - these are used for matching on `Keyword` fields i.e. exact matches
2.  Phrase queries - enabled partial matching (fields indexed with `Text` as their type
3.  Prefix queries - enable matching the start of contents of a field
4.  Wildcard - enables matching any single character with `?` or any number of characters with `*`
5.  Fuzzy queries - enable matching words that match if a few characters are changed e.g. name, tame or dame would all match a fuzzy query
6.  Range queries - allows finding values within a specific range, mostly numeric but can be used for strings as well 
7.  Match all queries - used when you don't know what to search for and just want to paginate all the data.

<!-- /wp:list -->

<!-- wp:paragraph -->

Hypi uses what's called an affinity function in Ignite to determine a set of Ignite nodes on which it will keep the index for a cache. In general both index and raw data share nodes, it will be possible in the future to have dedicated nodes for storing indices only.

<!-- /wp:paragraph -->

<!-- wp:paragraph -->

Using the Affinity function, Hypi consistently maps data around the cluster using [Rendezvous hashing.][11]

<!-- /wp:paragraph -->

<!-- wp:image {"id":787} --><figure class="wp-block-image">

<img src="https://hypi.io/wp-content/uploads/2019/03/Screen-Shot-2019-03-02-at-01.13.16-1024x561.png" alt="" class="wp-image-787" /><figcaption>Hypi query and data routing based on Affinity function</figcaption></figure> <!-- /wp:image -->

<!-- wp:paragraph -->

Hypi implements a graph system on top of ignite, this combined with search capabilities enables the automatic resolution of links in the relationships found in the GraphQL models. This means that when referencing an object, there's no need to store the "foreign key" and perform another query to resolve the foreign object, Hypi allows you to naturally express the relationship using the GraphQL SDL type system as demonstrated in the simple todo app model.

<!-- /wp:paragraph -->

<!-- wp:paragraph -->

ArcQL fully supports this. In the query types above field name is shown as a simple one word field. In reality, ArcQL supports implicit `JOIN` queries that are the equivalent of doing a `LEFT JOIN` in a relational database.

<!-- /wp:paragraph -->

<!-- wp:paragraph -->

For example, if you added comments to some items and wanted to find `Item` objects that had specific comments. A simple ArcQL query can be used to do this that may look like this

<!-- /wp:paragraph -->

<!-- wp:paragraph -->

`findItem(arcql: "comments.text ~ 'the text to search for'")`

<!-- /wp:paragraph -->

<!-- wp:paragraph -->

This simple but powerful query will find all items with comments matching the search text. What's more, given that it's a GraphQL query, if the GraphQL selection includes the comment field as in the below, then Hypi will automatically resolve comments belonging to the matching `Item` objects.

<!-- /wp:paragraph -->

<!-- wp:kebo/code {"lang":"Haskell","content":"  findItem(arcql: \u0022comments.text ~ 'the text to search for'\u0022) {\n    hypi {\n      id\n      created\n    }\n    slug\n    summary\n    started\n    due\n    comments (arcql: \u0022\u003cfurther-filter-comments-with-an-arcql-subquery\u003e\u0022){\n      hypi{id}\n      text\n    }\n  }","highlighted":"\n                \u003cdiv class=\u0022kbco-block kbco-github\u0022\u003e\n                    \n                    \u003cdiv class=\u0022kbco-code\u0022\u003e\u003cdiv class=\u0022kbco-lines\u0022\u003e\u003cpre class=\u0022kbco-line\u0022\u003e  \u003cspan class=\u0022kbco-variable\u0022\u003efindItem\u003c/span\u003e(\u003cspan class=\u0022kbco-variable\u0022\u003earcql\u003c/span\u003e\u003cspan class=\u0022kbco-keyword\u0022\u003e:\u003c/span\u003e\u0026nbsp;\u003cspan class=\u0022kbco-string\u0022\u003e\u0026#x22;comments.text ~ \u0026#x27;the text to search for\u0026#x27;\u0026#x22;\u003c/span\u003e)\u0026nbsp;{\u003c/pre\u003e\u003cpre class=\u0022kbco-line\u0022\u003e    \u003cspan class=\u0022kbco-variable\u0022\u003ehypi\u003c/span\u003e\u0026nbsp;{\u003c/pre\u003e\u003cpre class=\u0022kbco-line\u0022\u003e      \u003cspan class=\u0022kbco-builtin\u0022\u003eid\u003c/span\u003e\u003c/pre\u003e\u003cpre class=\u0022kbco-line\u0022\u003e      \u003cspan class=\u0022kbco-variable\u0022\u003ecreated\u003c/span\u003e\u003c/pre\u003e\u003cpre class=\u0022kbco-line\u0022\u003e    }\u003c/pre\u003e\u003cpre class=\u0022kbco-line\u0022\u003e    \u003cspan class=\u0022kbco-variable\u0022\u003eslug\u003c/span\u003e\u003c/pre\u003e\u003cpre class=\u0022kbco-line\u0022\u003e    \u003cspan class=\u0022kbco-variable\u0022\u003esummary\u003c/span\u003e\u003c/pre\u003e\u003cpre class=\u0022kbco-line\u0022\u003e    \u003cspan class=\u0022kbco-variable\u0022\u003estarted\u003c/span\u003e\u003c/pre\u003e\u003cpre class=\u0022kbco-line\u0022\u003e    \u003cspan class=\u0022kbco-variable\u0022\u003edue\u003c/span\u003e\u003c/pre\u003e\u003cpre class=\u0022kbco-line\u0022\u003e    \u003cspan class=\u0022kbco-variable\u0022\u003ecomments\u003c/span\u003e\u0026nbsp;(\u003cspan class=\u0022kbco-variable\u0022\u003earcql\u003c/span\u003e\u003cspan class=\u0022kbco-keyword\u0022\u003e:\u003c/span\u003e\u0026nbsp;\u003cspan class=\u0022kbco-string\u0022\u003e\u0026#x22;\u0026#x3C;further-filter-comments-with-an-arcql-subquery\u0026#x3E;\u0026#x22;\u003c/span\u003e){\u003c/pre\u003e\u003cpre class=\u0022kbco-line\u0022\u003e      \u003cspan class=\u0022kbco-variable\u0022\u003ehypi\u003c/span\u003e{\u003cspan class=\u0022kbco-builtin\u0022\u003eid\u003c/span\u003e}\u003c/pre\u003e\u003cpre class=\u0022kbco-line\u0022\u003e      \u003cspan class=\u0022kbco-variable\u0022\u003etext\u003c/span\u003e\u003c/pre\u003e\u003cpre class=\u0022kbco-line\u0022\u003e    }\u003c/pre\u003e\u003cpre class=\u0022kbco-line\u0022\u003e  }\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n                \u003c/div\u003e"} /-->

<!-- wp:paragraph -->

Notice the second `arcql` parameter here as well. It is entirely optional but means that you can perform a sub-query on comments that match the items that are being returned.

<!-- /wp:paragraph -->

<!-- wp:paragraph -->

With this, Hypi gives you the powerful capabilities of being able to do `JOIN` AND sub-queries, in a simple, concise and clear way...it even marshals them for you, a luxury afforded by GraphQL. 

<!-- /wp:paragraph -->

<!-- wp:paragraph -->

In a follow up post, we will discuss modelling with Hypi.  
We thank [GridGain][12] who organised the meetups and Oracle who also presented and demonstrated their new Timesten + Kubernetes integration.

<!-- /wp:paragraph -->

<!-- wp:gallery {"ids":[788,789]} -->

<ul class="wp-block-gallery columns-2 is-cropped">
  <li class="blocks-gallery-item">
    <figure><img src="https://hypi.io/wp-content/uploads/2019/03/IMG_0198.jpg" alt="" data-id="788" data-link="https://hypi.io/?attachment_id=788" class="wp-image-788" /></figure>
  </li>
  <li class="blocks-gallery-item">
    <figure><img src="https://hypi.io/wp-content/uploads/2019/03/IMG_0184.jpg" alt="" data-id="789" data-link="https://hypi.io/?attachment_id=789" class="wp-image-789" /></figure>
  </li>
</ul>

<!-- /wp:gallery -->

<!-- wp:paragraph -->

  


<!-- /wp:paragraph -->

 [1]: http://ignite.apache.org
 [2]: https://hypi.io
 [3]: https://ignite.apache.org/features/sql.html
 [4]: https://ignite.apache.org/features/machinelearning.html
 [5]: https://ignite.apache.org/features/tensorflow.html
 [6]: http://HypiQL
 [7]: https://www.meetup.com/Paris-In-Memory-Computing-Meetup/events/258793093/
 [8]: https://www.meetup.com/London-In-Memory-Computing-Meetup/events/258800682/
 [9]: https://graphql.org/
 [10]: https://lucene.apache.org
 [11]: https://en.wikipedia.org/wiki/Rendezvous_hashing
 [12]: https://www.gridgain.com/